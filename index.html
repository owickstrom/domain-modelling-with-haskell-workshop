<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Workshop: Domain Modelling with Haskell</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="workshop/style.css">
  <link rel="stylesheet" href="workshop/iosevka/iosevka.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Workshop: Domain Modelling with Haskell</h1>
<p class="subtitle"><a href="https://bit.ly/2HP4SCX">bit.ly/2HP4SCX</a></p>
</header>
<nav id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#installing-the-ghc-compiler">Installing the GHC compiler</a></li>
<li><a href="#cloning-and-installing-dependencies">Cloning and Installing Dependencies</a></li>
</ul></li>
<li><a href="#editing-workflow">Editing Workflow</a></li>
<li><a href="#part-1-data-structures">Part 1: Data Structures</a><ul>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#testing-your-implementation">Testing Your Implementation</a></li>
<li><a href="#bonus-exerices">Bonus Exerices</a></li>
</ul></li>
<li><a href="#digging-deeper">Digging Deeper</a></li>
<li><a href="#credits">Credits</a></li>
</ul>
</nav>
<p>Welcome to the “Domain Modelling with Haskell” workshop! This material is based on the screencast series from <a href="https://haskell-at-work.com">Haskell at Work</a>. It contains the instructions, exercises, and references for you to get started with Haskell and domain modelling, in the example domain of <em>project management</em>.</p>
<h2 id="introduction">Introduction</h2>
<p>We will model a simple project management system, and implement <em>reporting</em> functionality based on our core data structures. The sections in this workshop explore increasingly abstract techniques for working with Haskell data structures. We begin with regular Haskell data structures, monoids, and recursion.</p>
<p>Attendees should be comfortable with Haskell basics, preferably at the level of Haskell programming from first principles or similar. The workshop goal of this workshop is to provide a step from theoretical exercises into what tasks that are closer to &quot;bread and butter&quot; programming in industry.</p>
<h2 id="setup">Setup</h2>
<h3 id="installing-the-ghc-compiler">Installing the GHC compiler</h3>
<p>If you don’t have any strong preferences on your Haskell installation, and just want to get going, you can use <a href="https://haskellstack.org">Stack</a> to install the Haskell compiler, the required libraries, and compiling the code. The website has the <a href="https://docs.haskellstack.org/en/stable/README/#how-to-install">installation instructions</a> on the home page.</p>
<p>You can also use GHC and Cabal provided by <a href="https://www.haskell.org/platform/">Haskell Platform</a>, which has packages for many operating systems and distributions.</p>
<h3 id="cloning-and-installing-dependencies">Cloning and Installing Dependencies</h3>
<p>To get you up and running, begin by cloning this repository to your local machine using <a href="https://git-scm.com/">Git</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1">$ <span class="fu">git</span> clone https://github.com/owickstrom/domain-modelling-with-haskell-workshop.git</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">$ <span class="bu">cd</span> domain-modelling-with-haskell-workshop</a></code></pre></div>
<p>Then, install all dependencies and build the project by running the stack build command. It first installs the dependencies if missing, then builds the project.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">$ <span class="ex">stack</span> build</a></code></pre></div>
<p>If you are not using Stack, e.g. the Haskell Platform, run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1">$ <span class="ex">cabal</span> update</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">$ <span class="ex">cabal</span> install --only-dependencies</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">$ <span class="ex">cabal</span> configure</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">$ <span class="ex">cabal</span> build</a></code></pre></div>
<p>The Cabal file for this project, located at <code>domain-modelling.cabal</code> in the root directory, has a number of library dependencies already. That way, you will have them installed when you start, and complete the workshop without an internet connection.</p>
<p>All right! If all went well, you are ready to get started. You may edit Haskell files in any text editor you like. If you don’t have any strong preference, both <a href="https://code.visualstudio.com/">VS Code</a> and <a href="https://atom.io/">Atom</a> are easy to get started with.</p>
<p>Setting up Haskell tooling is way out of the scope of this workshop, and you will not need anything fancy. We will load and test the code in GHCi (the interactive GHC environment) anyway. If you are used to other functional programming languages, GHCi is equivalent of a <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a>.</p>
<h2 id="editing-workflow">Editing Workflow</h2>
<p>When you are done with the setup, begin by running the following command in your terminal. It will start GHCi and load the Project module.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1">$ <span class="ex">stack</span> repl</a></code></pre></div>
<p>Open your text editor and navigate to the workshop Git repository. Write all your code in <code>src/Project.hs</code> under the module header:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">module</span> <span class="dt">Project</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">-- Your stuff here!</span></a></code></pre></div>
<p>When you want to check some code you have written, type <code>:reload</code> in GHCi and hit Enter. If there are any type errors, GHCi will print them.</p>
<pre class="sourceCode ghci"><code>&gt; :reload
Ok, one module loaded.
Collecting type info for 1 module(s) ...</code></pre>
<h2 id="part-1-data-structures">Part 1: Data Structures</h2>
<p>You will begin by laying the groundwork for the project management system. The system will work with hierarchies of <em>projects</em>, <em>budgets</em>, <em>transactions</em>, and provide calculation of <em>reports</em>, showing a project's budgeted and actual profit. To keep the scope of the workshop down, the system will be implemented with fake database queries and will not have any graphical user interface.</p>
<p>Details and instructions about what you will build are listed below. Go through this list in order and implement each part. The nouns (or &quot;things&quot;) should be modelled as data types, and operations and queries as functions (using <code>IO</code> where needed.) Click the <strong>TIP</strong> boxes to get some assistance if you need.</p>
<p>Okay, let's begin!</p>
<h3 id="implementation">Implementation</h3>
<dl>
<dt>Project</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>The core concept in the system is a <em>project</em>. A project can be either a single project or a project group. Both single projects and project groups have <em>names</em>, and single projects also have <em>project IDs</em> (described below). A project group has a list of child projects.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>Represent project names using the <code>Text</code> data type instead of the built-in <code>String</code> type (see <a href="http://www.stephendiehl.com/posts/strings.html">A Sticky Stringy Quandry</a> for more details). Even if you often end up in situations where you need to convert back to <code>String</code>, make a habit of using <code>Text</code> by default.</p>
<p>Import the <code>Data.Text</code> module. Also, to be able to construct <code>Text</code> values with regular string literals, enable the <code>OverloadedStrings</code> language extension:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ot">{-# LANGUAGE OverloadedStrings          #-}</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">module</span> <span class="dt">Project</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Data.Text</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">-- Now you can construct Text values using string literals:</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="ot">myText ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">myText <span class="fu">=</span> <span class="st">&quot;Hello, lovely Haskell world!&quot;</span></a></code></pre></div>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>A data structure with multiple variants can be expressed using a data type with multiple <em>constructors:</em></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">data</span> <span class="dt">MyThing</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="fu">=</span> <span class="dt">RegularThing</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="fu">|</span> <span class="dt">OtherThing</span> <span class="dt">String</span></a></code></pre></div>
</div>
</blockquote>
<dl>
<dt>Project ID</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>A project ID uniqely identifies a <em>single</em> project (non-group project) in the system. It is a <a href="https://en.wikipedia.org/wiki/Natural_number">natural number</a>.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>Create a type for project IDs to make it more explicit, either using a type alias, or using a newtype.</p>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>A natural number can be represented using the <a href="http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Word.html">Word</a> type, which is the equivalent of <a href="https://en.wikipedia.org/wiki/C_data_types">unsigned int</a> from C.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">type</span> <span class="dt">ProjectId</span> <span class="fu">=</span> <span class="dt">Word</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="ot">myProjectId ::</span> <span class="dt">ProjectId</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">myProjectId <span class="fu">=</span> <span class="dv">1</span></a></code></pre></div>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>By wrapping in a newtype, instead of using a &quot;raw&quot; numeric type or a type alias, you make it safer to pass around in the code, as it cannot be mistakenly swapped with other integers.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">newtype</span> <span class="dt">ProjectId</span> <span class="fu">=</span> <span class="dt">ProjectId</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<p>Note that we use deriving, a way of having the compiler automatically create instances for the listed type classes. In this case we get</p>
<ul>
<li>an <code>Eq</code> instance, which lets us check if <code>ProjectId</code> values are equal, and</li>
<li>a <code>Show</code> instance, which gives us a <code>String</code> representation of a <code>ProjectId</code> value.</li>
</ul>
<p>When we use a newtype, the following code would cause a type error.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ot">pId ::</span> <span class="dt">ProjectId</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">pId <span class="fu">=</span> <span class="dt">ProjectId</span> <span class="dv">123</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">ohNo <span class="fu">=</span> pId <span class="fu">*</span> <span class="dv">4</span></a></code></pre></div>
</div>
</blockquote>
<dl>
<dt>Budget</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>A budget describes the expected <em>income</em> and <em>expenditure</em> for a project, both being monetary values.</p>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>A Haskell data type with multiple fields can be expressed using record syntax:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">data</span> <span class="dt">Budget</span> <span class="fu">=</span> <span class="dt">Budget</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  {<span class="ot"> budgetIncome ::</span> <span class="dt">Money</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  ,<span class="ot"> budgetExpenditure ::</span> <span class="dt">Money</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  } <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>)</a></code></pre></div>
</div>
</blockquote>
<dl>
<dt>Transaction</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>A transaction is a very simplified concept describing a <em>sale</em> or a <em>purchase</em>. Each type of transaction has an amount (a monetary value.)</p>
</blockquote>
<dl>
<dt>Money</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>A representation of monetary values.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>Represent <code>Money</code> using the <code>Decimal</code> type from the <a href="https://hackage.haskell.org/package/Decimal-0.5.1/docs/Data-Decimal.html">Decimal</a> package. You do not need to care about currency, only the amount.</p>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>Create a <code>newtype</code> for monetary values by wrapping the <code>Decimal</code> type:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">module</span> <span class="dt">Project</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Data.Decimal</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">newtype</span> <span class="dt">Money</span> <span class="fu">=</span> <span class="dt">Money</span> <span class="dt">Decimal</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>)</a></code></pre></div>
</div>
</blockquote>
<dl>
<dt>Get Budget by Project ID</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>Given a project ID, we need to be able to retrieve a budget for the corresponding project.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>To keep the scope of this workshop limited we will not use a real database. Instead, hard-code a result, making it a &quot;fake&quot; query. The function should still return <code>IO</code>, e.g:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ot">getBudget ::</span> <span class="dt">ProjectId</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Budget</span></a></code></pre></div>
<p>If you want to use a real database, consider that a follow-up exercise.</p>
</div>
</blockquote>
<dl>
<dt>Get Transactions by Project ID</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>Given a project ID, we need to be able to retrieve a list of transactions for the corresponding project.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>Again, to keep the scope of this workshop limited we will not use a real database. Instead, hard-code a result, making it a &quot;fake&quot; query. The function should still return <code>IO</code>, e.g:</p>
<blockquote>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="ot">getTransactions ::</span> <span class="dt">ProjectId</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> [<span class="dt">Transaction</span>]</a></code></pre></div>
</blockquote>
</div>
</blockquote>
<dl>
<dt>Report</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>A report represents the result of the <em>report calculation</em>. It has a <em>budget profit</em>, a <em>net profit</em>, and a <em>difference</em>, all being monetary values.</p>
</blockquote>
<dl>
<dt>Calculate Report</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>Create a report from a budget and a list of transactions. It calculates a report, where:</p>
<p><span class="math display">\[\text{budget profit} = \text{income} - \text{expenditure}\]</span><span class="math display">\[\text{net profit} = \text{sales} - \text{purchases}\]</span><span class="math display">\[\text{difference} = \text{net profit} - \text{budget profit}\]</span></p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>The report calculation function should be a pure function, i.e. not using <code>IO</code>. Give it a type signature like:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ot">calculateReport ::</span> <span class="dt">Budget</span> <span class="ot">-&gt;</span> [<span class="dt">Transaction</span>] <span class="ot">-&gt;</span> <span class="dt">Report</span></a></code></pre></div>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>Derive an instance of the <code>Num</code> class for <code>Money</code> so that you can use regular arithmetic operators in your calculation. To do this you also need enable the <code>GeneralizedNewtypeDeriving</code> extension.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="ot">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">module</span> <span class="dt">Project</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">-- other code ...</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw">newtype</span> <span class="dt">Money</span> <span class="fu">=</span> <span class="dt">Money</span> <span class="dt">Decimal</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>, <span class="dt">Num</span>)</a></code></pre></div>
<p>Now you can add money values together:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1">pocketMoney <span class="fu">=</span> <span class="dt">Money</span> <span class="dv">123</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">savings <span class="fu">=</span> <span class="dt">Money</span> <span class="dv">4567</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">allMyCash <span class="fu">=</span> pocketMoney <span class="fu">+</span> savings</a></code></pre></div>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>Consider folding over the list of transactions using a function from <a href="http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html">Data.Foldable</a>. You can use foldl', or <code>foldMap</code> if you can find a <code>Monoid</code> that sums money values.</p>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>There is a <code>Monoid</code> instance for <code>Sum</code>, that sums the wrapped values using the <code>+</code> operator. You can use <code>getSum</code> and <code>foldMap</code> to map the list of transactions into a list of positive or negative <code>Money</code> values, and sum them using <code>Sum</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1">netProfit&#39; <span class="fu">=</span> getSum (foldMap asProfit transactions)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">asProfit (<span class="dt">Sale</span> m)     <span class="fu">=</span> pure m</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">asProfit (<span class="dt">Purchase</span> m) <span class="fu">=</span> pure (negate m)</a></code></pre></div>
</div>
</blockquote>
<dl>
<dt>Calculate Project Report</dt>
<dd>
</dd>
</dl>
<blockquote>
<p>Given a project, this function calculates a single aggregated report for the entire project hierarchy. It needs to recursively walk the projects, query their budgets and transactions, calculate reports, and combine those reports into one.</p>
<div class="note">
<div class="admonition-title">
<p>Note</p>
</div>
<p>The project report calculation function returns <code>IO Report</code>, e.g.:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="ot">calculateProjectReport ::</span> <span class="dt">Project</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Report</span></a></code></pre></div>
<p>Use the (fake) queries you wrote earlier to obtain a budget and a list of transactions for each project.</p>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>Create an instance of <code>Monoid</code> for <code>Report</code> and use it to combine reports:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Monoid</span> <span class="dt">Report</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  mempty <span class="fu">=</span> <span class="dt">Report</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  mappend (<span class="dt">Report</span> b1 n1 d1) (<span class="dt">Report</span> b2 n2 d2) <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="dt">Report</span> (b1 <span class="fu">+</span> b2) (n1 <span class="fu">+</span> n2) (d1 <span class="fu">+</span> d2)</a></code></pre></div>
<p>Now you can combine a list of reports using <code>fold</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="ot">megaReport ::</span> <span class="dt">Report</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">megaReport <span class="fu">=</span> fold [report1, report2, report3]</a></code></pre></div>
</div>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>Recurse through the project hierarchy by pattern matching on the constructors,</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="ot">calculateProjectReport ::</span> <span class="dt">Project</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Report</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">calculateProjectReport (<span class="dt">SingleProject</span> projectId _) <span class="fu">=</span> _</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">calculateProjectReport (<span class="dt">ProjectGroup</span> _ projects) <span class="fu">=</span> _</a></code></pre></div>
<p>and by folding the result of recursively applying <code>calculateProjectReport</code> on project group children:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1">foldMap calculateProjectReport _childProjects</a></code></pre></div>
</div>
</blockquote>
<h3 id="testing-your-implementation">Testing Your Implementation</h3>
<p>Whew! Those are all the things needed in the project management system. To try report calculation, define <code>someProject :: Project</code> at the top-level in <code>Project.hs</code>. You may construct this value however you like, but make sure to have at least two levels of project groups.</p>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>As an example of a project value, the following represents a Swedish project hierarchy of some sort.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="ot">someProject ::</span> <span class="dt">Project</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">someProject <span class="fu">=</span> <span class="dt">ProjectGroup</span> <span class="st">&quot;Sweden&quot;</span> [stockholm, gothenburg, malmo]</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">    stockholm <span class="fu">=</span> <span class="dt">SingleProject</span> (<span class="dt">ProjectId</span> <span class="dv">1</span>) <span class="st">&quot;Stockholm&quot;</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">    gothenburg <span class="fu">=</span> <span class="dt">SingleProject</span> (<span class="dt">ProjectId</span> <span class="dv">2</span>) <span class="st">&quot;Gothenburg&quot;</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">    malmo <span class="fu">=</span> <span class="dt">ProjectGroup</span> <span class="st">&quot;Malmö&quot;</span> [city, limhamn]</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">    city <span class="fu">=</span> <span class="dt">SingleProject</span> (<span class="dt">ProjectId</span> <span class="dv">3</span>) <span class="st">&quot;Malmö City&quot;</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8">    limhamn <span class="fu">=</span> <span class="dt">SingleProject</span> (<span class="dt">ProjectId</span> <span class="dv">4</span>) <span class="st">&quot;Limhamn&quot;</span></a></code></pre></div>
</div>
<p>Now, go back to GHCi, reload, and apply the report calculation function to the <code>someProject</code> value. Do you get a single report back?</p>
<div class="tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<p>To calculate a report in GHCi, run something like the following, and you should see the report data structure printed.</p>
<pre class="sourceCode ghci"><code>&gt; :reload
λ&gt; calculateProjectReport someProject
Report {budgetProfit = Money 800, netProfit = Money -568, difference = Money -1368}</code></pre>
</div>
<p>Congratulations! You have completed the first part of &quot;Domain Modelling with Haskell.&quot;</p>
<h3 id="bonus-exerices">Bonus Exerices</h3>
<ol type="1">
<li>Create functions for pretty-printing projects and reports.
<ul>
<li><p>Render the project by creating a <a href="https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Tree.html">Tree</a> from a project, and rendering that using <code>drawTree</code>. Then you can run the following in GHCI:</p>
<pre class="sourceCode ghci"><code>&gt; putStrLn (prettyProject someProject)
Sweden
   |
   +- Stockholm (1)
   |
   +- Gothenburg (2)
   |
   `- Malmö
   |
   +- Malmö City (3)
   |
   `- Limhamn (4)</code></pre></li>
<li><p>Render the report as a string similar to this:</p>
<pre class="sourceCode ghci"><code>&gt; putStrLn (prettyReport myReport)
Profit: 800, Net: -568, Diff: -1368</code></pre></li>
</ul></li>
<li>Convert the hard-coded queries to generate random values using <a href="http://hackage.haskell.org/package/random-1.1/docs/System-Random.html">System.Random</a>.</li>
<li>One to save for for a rainy day: Convert the hard-coded or random-generated query results to use a real database, e.g. PostgreSQL or MySQL. Haskell has many options for working with relational databases.</li>
</ol>
<h2 id="digging-deeper">Digging Deeper</h2>
<p>This workshop is based on the video series from Haskell at Work:</p>
<ol type="1">
<li><a href="https://haskell-at-work.com/episodes/2018-01-19-domain-modelling-with-haskell-data-structures.html">Data Structures</a></li>
<li><a href="https://haskell-at-work.com/episodes/2018-01-22-domain-modelling-with-haskell-generalizing-with-foldable-and-traversable.html">Generalizing with Foldable and Traversable</a></li>
<li><a href="https://haskell-at-work.com/episodes/2018-02-02-domain-modelling-with-haskell-accumulating-with-writert.html">Accumulating with WriterT</a></li>
<li><a href="https://haskell-at-work.com/episodes/2018-02-11-domain-modelling-with-haskell-factoring-out-recursion.html">Factoring Out Recursion</a></li>
</ol>
<p><strong>Parts 2-4 have not been added to this workshop yet.</strong> If you want to explore further, I can recommend checking out those videos and the show notes. Also, the full source code for the videos is available at <a href="https://github.com/haskell-at-work/domain-modelling-with-haskell" class="uri">https://github.com/haskell-at-work/domain-modelling-with-haskell</a>.</p>
<h2 id="credits">Credits</h2>
<p>A huge thanks to <a href="https://twitter.com/vbhvsgr">@vbhvsgr</a>, <a href="https://twitter.com/evanborden">@evanborden</a>, <a href="https://twitter.com/trupill">@trupill</a>, <a href="https://twitter.com/paulcadman">@paulcadman</a>, <a href="https://twitter.com/themattchan">@themattchan</a>, and <a href="https://twitter.com/mathapptician">@mathapptician</a> for proof-reading and giving feedback on this material!</p>
<script>
document.querySelectorAll('.tip').forEach(function (tip) {
  tip.addEventListener('click', function () {
    console.log('hello');
    tip.classList.toggle('visible');
  });
});
</script>
<footer>
    Copyright &copy; 2018 Oskar Wickström
</footer>
</body>
</html>
